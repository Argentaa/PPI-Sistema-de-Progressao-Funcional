{% if cppd == 1 %}
  {% extends "base_cppd.html" %}
{% else %}
  {% extends "base_requerimento.html" %}
{% endif %}

{% block conteudo %}

<style>

    body {
      background-image: url('..\\..\\static\\background.jpeg');
    }

    h1 {
        text-align: center;
        margin-top: 50px;
        font-family: "Poppins";
        color: whitesmoke;
        font-size: 40px;
        font-weight: 700;
    }
    h2 {
        font-family: "Poppins";
        font-size: 20px;
        font-weight: 500;
        text-align: right;
        margin-bottom: 32px;

    }
    h3 {
        text-align: center;
        margin-top: 10px;
        font-family: "Poppins";
        color: white;
        font-size: 20px;
        font-weight: 400;
    }
    h4 {
        font-size: 10px;
        padding-top: 0px;

    }
    .container{
        margin-top: 20px;
    }
    .col-sm-8{
        margin-top: 3px;
    }
    .input-style {
        display: inline-block;
        width: 64px;
        height: calc(1.5em + 0.75rem + 2px);
        padding: 0.375rem 0.75rem;
        font-size: 1rem;
        font-weight: 400;
        line-height: 1.5;
        color: #495057;
        background-color: #fff;
        background-clip: padding-box;
        border: 1px solid #ced4da;
        border-radius: 0.25rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        text-align: center;
    }
    
</style>

<div class="container">
    <div class="row">
        <div class="col-sm-8 col-md-8 col-lg-8 mx-auto">
            <div class="card border-0 shadow rounded-3 my-5">
                <div class="card-body p-2 p-sm-2">
                    <div class="row">
                        <div class="col-sm-4" style="text-align: center;">
                        <br>
                            <img src="{{url_for('static', filename=docente[5])}}" width="200" height="200" class="image">
                        </div>
                        <div class="col-sm-8">
                            <br>
                            <h5>Professor(a): {{docente[1]}}</h5>
                            <h5>Número SIAPE: {{docente[2]}}</h5>
                            <h5>Email: {{docente[3]}}</h5>
                            <h5>CPF: {{docente[0]}}</h5>
                            {% if nivelcap == "" %}
                                <h5>Nivel Capacitação: Faça um requerimento para mostrar</h5>
                            {% else %}
                                <h5>Nivel Capacitação: {{docente[4]}}</h5>
                            {% endif %}
                        </div>
                        <div class="row justify-content-end">
                            <div class="col-sm-3">
                                <a class="btn btn-warning btn-sm"
                                    data-bs-toggle="modal"
                                    data-bs-target="#verificarDados" href="#"
                                    type="button" style="color: black; font-family:
                                    'Poppins'; font-weight: 300;">Verificar Dados</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="verificarDados" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLongTitle">Dados do Docente</h5>
            </div>
            <div class="modal-body">
                <form method="POST" action="{{ url_for('requerimentos.meus_requerimentos') }}">

                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="floatingEscolaridade" placeholder="Escolaridade" name="Escolaridade" value="{{docente[6]}}" disabled>
                        <label for="floatingEscolaridade">Escolaridade</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="floatingAperfeiçoamento" placeholder="Aperfeiçoamento" name="Aperfeiçoamento" value="{{docente[7]}}" disabled>
                        <label for="floatingAperfeiçoamento">Aperfeiçoamento</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="floatingEspecialização" placeholder="Especialização" name="Especialização" value="{{docente[8]}}" disabled>
                        <label for="floating">Especialização</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="floatingMestrado" placeholder="Mestrado" name="Mestrado" value="{{docente[9]}}" disabled>
                        <label for="floating">Mestrado</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="floatingDoutorado" placeholder="Doutorado" name="Doutorado" value="{{docente[10]}}" disabled>
                        <label for="floatingDoutorado">Doutorado</label>
                    </div>

                    <hr>

                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="floatingLotacao" placeholder="Lotação" name="Lotacao" value="{{docente[11]}}" disabled>
                        <label for="floatingLotacao">Lotação</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="floatingDiretoria" placeholder="Diretoria" name="Diretoria" value="{{docente[12]}}" disabled>
                        <label for="floatingDiretoria">Diretoria</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="floatingCoordenacao" placeholder="Coordenação" name="Coordenacao" value="{{docente[13]}}" disabled>
                        <label for="floatingCoordenacao">Coordenação/Setor</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="floatingCargo" placeholder="Cargo" name="Cargo" value="{{docente[14]}}" disabled>
                        <label for="floatingCargo">Cargo/Função</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="floatingChefia" placeholder="Chefia" name="Chefia" value="{{docente[15]}}" disabled>
                        <label for="floatingChefia">Chefia Imediata</label>
                    </div>

                    <br>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% for parte, l in criteriosdict.items() %}

        <h1>{{parte}}</h1>

    {% for categoria, k in l.items(): %}
        <h3>{{categoria}}</h3>
        
        <div class="container">
            <div class="row">
                <div class="col-sm-10 col-md-10 col-lg-10 mx-auto">
                    <div class="card border-5 shadow rounded-3">
                        <div class="card-body p-3 p-sm-9">
                            {% for criterio, pontos, ponto_mult, tipo_ponto, id_crit in k %}
                                {% if id_crit in arquivosdict %}
                                    <div class="row ses">
                                        <div class="col-sm-6">
                                            <h2>{{ criterio}}</h2>
                                        </div>
                                        <div class="col-sm-1">
                                            <div class="input-group mb-3">
                                                {% for avaliacao in avaliacoes %}
                                                    {% if avaliacao[1] == id_crit %}
                                                        <input type="text" value="{{ avaliacao[2] }}" class="form-control" style="text-align: center" pattern="[0-9]+" title="Apenas números são permitidos" onblur="VerificarPreenchimento(this)" name="{{id_crit}}criterio{{ criterio }}" oninput="ChamarTodas(this)" disabled>
                                                        <input type="text" class="form-control" style="text-align: center; display: none;" pattern="[0-9]+" title="Apenas números são permitidos" name="{{id_crit}}criteriocorreção{{ criterio }}" oninput="ChamarTodas(this)">
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>
                                        <div class="col-sm-4">
                                            <div class="row">
                                                <div class="col-5">
                                                    <h4>{{ pontos }}</h4>
                                                </div>
                                                
                                                <div class="col-7">
                                                    <a class="btn btn-success btn-sm"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#visualizarArquivo{{arquivosdict[id_crit]}}" href="#"
                                                    type="button"><i class="bi bi-file-earmark-check-fill" style="font-size: 15px;"></i></a>
                                                </div>

                                                <div class="modal fade" id="visualizarArquivo{{arquivosdict[id_crit]}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                                                    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                                <h5 class="modal-title" id="exampleModalLongTitle">Visualizar arquivo já enviado</h5>
                                                            </div>
                                                            <div class="modal-body">
                                                                <div style="text-align: center; font-size: 20px;">
                                                                    <i class="bi bi-filetype-pdf"></i> {{arquivosdict[id_crit][33:]}} <br><br>
                                                                </div>
                                                                <iframe src="{{ url_for('static', filename=arquivosdict[id_crit]) }}" width="765" height="400"></iframe>
                                                            </div>
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                            <hr>
                            <div class="row ses">
                                <div class="col-sm-6">
                                    <h2>Total de pontos para categoria</h2> 
                                </div>
                                
                                <div class="col-sm-1">
                                    <span id="total{{ categoria }}" class="input-style"></span>
                                </div>
                                
                            </div>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <br>
    {% endfor %}
{% endfor %}

<script>

    window.onload = function() {
        calculateMultiplication()
    }

    function calculateMultiplication() {
        {% for parte, l in criteriosdict.items() %}
            {% for categoria, k in l.items() %}
                var total_categoria = 0;
                var total_categoria_correcao = 0;

                {% for criterio, pontos, ponto_mult, tipo_ponto, id_crit in k %}
                    {% if id_crit in arquivosdict %}
                        var inputCorrecao = '{{id_crit}}criteriocorreção{{ criterio }}'
                        var inputName = '{{id_crit}}criterio{{ criterio }}';

                        var valueCorrecao = parseFloat(document.querySelector('input[name="' + inputCorrecao + '"]').value);
                        var value = parseFloat(document.querySelector('input[name="' + inputName + '"]').value);

                        if (!isNaN(valueCorrecao)) {
                            if ('{{ tipo_ponto }}' === 'Multiplicacao') {
                                total_categoria_correcao  += valueCorrecao * {{ ponto_mult }};
                            } 
                            else if ('{{ tipo_ponto }}' === 'Maximo') {
                                if (valueCorrecao > {{ ponto_mult }}){
                                    total_categoria_correcao  += {{ ponto_mult }};
                                }
                                else {
                                    total_categoria_correcao  += valueCorrecao;
                                }
                            }
                            else {
                                total_categoria_correcao  *= valueCorrecao;
                            }
                        }

                        if (!isNaN(value)) {
                            if ('{{ tipo_ponto }}' === 'Multiplicacao') {
                                total_categoria += value * {{ ponto_mult }};
                            } 
                            else if ('{{ tipo_ponto }}' === 'Maximo') {
                                if (value > {{ ponto_mult }}){
                                    total_categoria += {{ ponto_mult }};
                                }
                                else {
                                    total_categoria += value;
                                }
                            }
                            else {
                                total_categoria *= value 
                            }
                        }
                    {% endif %}
                {% endfor %}
                document.getElementById('total{{ categoria }}').textContent = total_categoria;
                document.getElementById('totalcorrecao{{ categoria }}').textContent = total_categoria_correcao;
            {% endfor %}
        {% endfor %}
    }
    
    function ChamarTodas(input){
        calculateMultiplication();
    }

</script>


{% endblock conteudo %}


